/** Bubble News jQuery plugin vBeta
 *  (c) Michele Puddu - modok64@hotmail.com - http://www.oim-worlds.com/
 *  License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function(a,b){var c="bubbleNews",d=b,e=null,f='<p>Bubbles News: <strong>Michi P</strong>: <em>modok64@hotmail.com</em> - <em><a href="http://www.oim-worlds.com" target="_blank">http://www.oim-worlds.com/</a></em></p>';$dom={global:null,insertNewFeed:null,alert:null,upper:null,lower:null,clouds:null,gravityAttractor:null,copy:null},Environment=new function(){var a=0,c=1e3,d=9.8,e=.9;this.Wind=function(c){if(c===b||isNaN(c)||c<0)return a;else{a=c;return a}};this.Turbolence=function(a){if(a===b||isNaN(a)||a<0)return c;else{c=a;return c}};this.Gravity=function(a){if(a===b||isNaN(a)||a<1){return d}else{d=a;return d}};this.Friction=function(a){if(a===b||isNaN(a)||a<0)return e;else{e=a;return e}}},BubbleCannon=function(a){var c=parseInt(a)||3,d=c*Environment.Gravity(),e;this.boostReal=d;this.Boost=function(a){if(a===b||isNaN(a)){return c}else if(a<1)return"boost can't be lesser then 1";else{c=a;return c}};this.shot=function(a){e[a].start(d)};this.loadGunPowder=function(){d=c*Environment.Gravity()};this.loadBubbles=function(a){e=a}},BubbleEngine=new function(){var c=this,e=0,f=false,g=new BubbleCannon;timer=b,mainLoop=function(){var b=false;for(var c in d){var f=d[c];if(f.isAlive){b=true;f.move();if(c==e){var h=a(window).height();var j=h-(parseInt(f.height)+parseInt(f.y));var k=0;var l=g.boostReal;while(l>1){l*=Environment.Friction();k+=l}if(k<=j){var m=++e;if(m>=d.length){m=0;e=0}g.shot(m)}}}}if(!b){if(e>=d.length)e=0;g.shot(e)}};this.init=function(){if(f)return;g.loadBubbles(d);f=true;this.start()};this.start=function(){if(!timer){timer=setInterval(function(){mainLoop()},1e3/60)}};this.stop=function(){clearInterval(timer);timer=null};this.newFeed=function(a){this.stop();e=0;for(b in d){d[b].dispose()}d.length=0;for(var b in a){if(!!a[b].link)d.push(new Bubble(a[b]))}this.start()}},Bubble=function(c){var d=this,e=0,f=true,g,h,i=c;this.y=a(window).height();this.isAlive=false;this.toRestartOnFinish=false;this.toRight=true;this.dom=a('<div class="agc-bubble-container" style="top:'+d.y+'px"><div class="agc-bubble"> </div><div class="agc-bubble-news">'+i.title+"</div></div>");this.dom.click(function(){j()});this.start=function(b){if(this.isAlive){this.toRestartOnFinish=true;return}h=b;this.isAlive=true;this.y=a(window).height();this.dom.css("top",this.y);this.dom.appendTo($dom.global);this.width=this.dom.width();this.height=this.dom.height();this.x=Math.abs((Math.random()*$dom.global.width()).toFixed(0)-this.width)};this.move=function(){h*=Environment.Friction();if(h<.5)h=.5;if(d.y<=$dom.gravityAttractor.height()+$dom.gravityAttractor.position().top)h*=1.2;d.y-=h.toFixed(1);if(Environment.Turbolence()!=0){if(f){if(this.toRight){d.x+=1*Environment.Wind()}else{d.x-=1*Environment.Wind()}e++;if(e>=Environment.Turbolence()){f=false}}}this.dom.css({top:d.y,right:d.x});if(d.y+d.height<0)d.destroy()};this.destroy=function(){d.isAlive=false;this.dom.detach();if(this.toRestartOnFinish){this.toRestartOnFinish=false;this.start()}};this.dispose=function(){d.isAlive=false;d.toRestartOnFinish=false;this.dom.remove()};var j=function(){var c=!i.origLink?i.link.href:i.origLink;if(typeof c==="object"&&c.length>1)if(!!c[0].content)c=c[0].content;if(!!c.content)c=c.content;else if(!!c.content)c=c.content;if(!!i.summary.content&&i.summary.content.length>200){var d=a("<div></div>").html(i.summary.content);d.find('a:not([href^="http"])').remove();d.find("a").attr("target","_blank");g=a('<div class="agc-bubble-preview"><div class="agc-box"><div class="agc-close"></div><div class="agc-container"><h3><a href="'+c+'" target="_blank">'+i.title+"</a></h3>"+d.html()+"</div></div></div>");var e=g.find(".agc-box");var f=g.find(".agc-container");g.find(".agc-close").click(function(){BubbleEngine.start();g.remove();g=b});a("body").append(g);var h=e.width();var j=e.height();e.css({width:"20px",height:"20px"});e.animate({width:h}).animate({height:j},"fast",function(){f.fadeIn()});BubbleEngine.stop()}else{window.open(c)}}};var g={init:function(b){if(!!a(this).data(c))return;var d={feedType:"rss"},g,h=$dom.global=a(this);h.css({position:"fixed","z-index":1e4,right:0,bottom:0,top:0,width:300});e=h.selector;g=a.extend({},d,b,true);$dom.global.data(c,g);$dom.upper=a('<div class="agc-upper"></div>');$dom.lower=a('<div class="agc-lower"></div>');$dom.gravityAttractor=a('<div class="agc-gravity-attractor"></div>');$dom.alert=a('<div class="agc-alert">bubbles are loading</div>');$dom.copy=a('<div class="agc-copy">'+f+"</div>");$dom.upper.append($dom.gravityAttractor);$dom.lower.append($dom.alert);$dom.lower.append($dom.copy);$dom.global.append($dom.upper);$dom.global.append($dom.lower);a("<script>function updateFeed(feed) {jQuery('"+h.selector+"')."+c+"('update', feed.query); "+"}</script>").appendTo("head");a("<script>function receiverFeed(feed) {jQuery('"+h.selector+"')."+c+"('receive', feed.query); "+"}</script>").appendTo("head");a("<script src='http://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20feednormalizer%20WHERE%20output%3D%22atom_1.0%22 AND url%3D%22"+g.url+"%22&format=json&callback=receiverFeed'></script>").appendTo("head")},receiveTweet:function(a){if(!!window.console)console.log(a)},receive:function(b){if(!a(this).data(c)){return}$dom.copy.html('Feed: <a href="'+$dom.global.data(c).url+'" target="_blank">'+$dom.global.data(c).url+"</a>").append(f);$dom.insertNewFeed=a('<div class="agc-new-feed"><input type="text" placeholder="New Feed URL"></div>');$dom.insertNewFeed.find('input[type="text"]').on("keyup",function(b){if(b.which===13){var d=a(this).val();$dom.global[c]("newFeed",d);a(this).val("")}});$dom.lower.prepend($dom.insertNewFeed);$dom.lower.prepend('<div class="agc-options"><div class="agc-rss"></div><div class="agc-question"></div></div>');var e=$dom.lower.find(".agc-rss");var g=$dom.lower.find(".agc-question");e.toggle(function(){$dom.insertNewFeed.fadeIn()},function(){$dom.insertNewFeed.fadeOut()});g.toggle(function(){$dom.copy.slideDown()},function(){$dom.copy.slideUp()});d=[];if(!!b.count){$dom.insertNewFeed.delay(1e3).fadeOut();for(var h in b.results.feed.entry){if(!!b.results.feed.entry[h].link)d.push(new Bubble(b.results.feed.entry[h]))}$dom.alert.slideUp("slow");BubbleEngine.init()}else{$dom.alert.slideDown("slow").html("feed empty. Try again")}},newFeed:function(b){if(!a(this).data(c)){return}a("<script src='http://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20feednormalizer%20WHERE%20output%3D%22atom_1.0%22 AND url%3D%22"+b+"%22&format=json&callback=updateFeed'></script>").appendTo("head");$dom.alert.html("bubbles are loading").slideDown("slow");$dom.copy.html('Feed: <a href="'+b+'" target="_blank">'+b+"</a>").append(f)},update:function(b){if(!a(this).data(c)){return}if(!b){$dom.alert.slideDown("slow").html("URL Invalid. Check and try again").delay(2e3).slideUp("slow");return}if(b.count>0){$dom.insertNewFeed.fadeOut();var d=$dom.upper.find(".agc-rss");d.trigger("click");$dom.alert.slideUp("slow");BubbleEngine.newFeed(b.results.feed.entry);BubbleEngine.init()}else{$dom.alert.slideDown("slow").html("Feed empty. Try again").delay(2e3).slideUp("slow")}},suspend:function(){if(!a(this).data(c)){return}BubbleEngine.stop()},resume:function(){if(!a(this).data(c)){return}BubbleEngine.start()}};a.fn[c]=function(b){if(g[b]){return g[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return g.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery."+c)}}})(jQuery)